<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Formacción | Plataforma de Formación Online</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React y Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDK (Versión Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Scrollbar personalizado sutil */
        .custom-scrollbar::-webkit-scrollbar {
            width: 5px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #f97316;
        }

        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn-primary {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:active {
            transform: scale(0.95);
        }

        /* Estilo unificado para tarjetas */
        .card-unified {
            background-color: white;
            padding: 1.5rem;
            border-radius: 2rem;
            border-width: 1px;
            border-color: #f1f5f9;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .card-unified:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            border-color: #fed7aa;
        }

        /* Clase para botones activos unificados */
        .btn-active-orange {
            background-color: #f97316 !important;
            color: white !important;
            box-shadow: 0 10px 15px -3px rgba(249, 115, 22, 0.25);
            border-color: #f97316 !important;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDSx17aEbbXtkIekwoSV1ephvhkmm9A4jw", 
            authDomain: "eformaccion-14518.firebaseapp.com",
            projectId: "eformaccion-14518",
            storageBucket: "eformaccion-14518.firebasestorage.app",
            messagingSenderId: "320840168859",
            appId: "1:320840168859:web:95b87e63f3dc8344cbdd3e"
        };

        const appId = 'e-formacion-pro-v1';

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        const LOGO_URL = "https://lh3.googleusercontent.com/d/134alSdlXnIMpFW7vcKaTF2lR6WtpwLku"; 
        const CONTACTO = { telefono: "+34 662 161 472", email: "eformaccion@gmail.com" };

        const TIPO_MATERIAL = {
            TEMA: { label: 'Temario PDF', icon: 'book-open', color: 'bg-blue-50 text-blue-600' },
            EXAMEN: { label: 'Exámenes PDF', icon: 'file-check', color: 'bg-green-50 text-green-600' },
            VIDEO: { label: 'Vídeo Clases', icon: 'video', color: 'bg-orange-50 text-orange-600' },
            TEST: { label: 'Tests Interactivos', icon: 'clipboard-check', color: 'bg-amber-50 text-amber-600' },
            ENLACE: { label: 'Enlaces de interés', icon: 'globe', color: 'bg-purple-50 text-purple-600' }
        };

        const Icon = ({ name, className = "w-5 h-5", ...props }) => {
            const containerRef = useRef(null);

            useLayoutEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = `<i data-lucide="${name}" class="${className}"></i>`;
                    window.lucide.createIcons({
                        targets: [containerRef.current]
                    });
                }
            }, [name, className]);

            return <span ref={containerRef} className="inline-flex items-center justify-center pointer-events-none" {...props}></span>;
        };

        const Modal = ({ title, children, onClose }) => (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
                <div className="bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden fade-in">
                    <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <h3 className="text-lg font-black text-slate-800 uppercase tracking-tight">{title}</h3>
                        <button onClick={onClose} className="p-2 hover:bg-white hover:shadow-sm rounded-full transition-all text-slate-400">
                            <Icon name="x" className="w-6 h-6" />
                        </button>
                    </div>
                    <div className="p-6 max-h-[80vh] overflow-y-auto scrollbar-hide">{children}</div>
                </div>
            </div>
        );

        function App() {
            const [user, setUser] = useState(null); 
            const [loggedInUser, setLoggedInUser] = useState(null); 
            const [isAdmin, setIsAdmin] = useState(false);
            const [activeTab, setActiveTab] = useState('noticias');
            const [selectedOpo, setSelectedOpo] = useState(null);
            const [loading, setLoading] = useState(true);
            const [showLogin, setShowLogin] = useState(false); 
            const [viewMode, setViewMode] = useState('public'); 
            const [error, setError] = useState('');
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            
            const [dateTime, setDateTime] = useState(new Date());

            const [noticias, setNoticias] = useState([]);
            const [categoriasOposicion, setCategoriasOposicion] = useState([]);
            const [proximosCursos, setProximosCursos] = useState([]);
            const [listaAlumnos, setListaAlumnos] = useState([]);
            const [documentos, setDocumentos] = useState([]);
            const [clasesDirecto, setClasesDirecto] = useState([]);

            const [showModal, setShowModal] = useState(null); 
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                titulo: '', contenido: '', url: '', nombre: '', descripcion: '', 
                tipo: 'TEMA', username: '', password: '', oposicion: '', fecha: '', lanzamiento: '', 
                hora: '', plataforma: ''
            });

            useEffect(() => {
                const timer = setInterval(() => setDateTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await auth.signInAnonymously();
                    } catch (err) {
                        console.error("Auth Error:", err);
                    } finally {
                        setLoading(false);
                    }
                };
                initAuth();
                const unsubscribe = auth.onAuthStateChanged((u) => setUser(u));
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;

                const createListener = (collectionName, setter) => {
                    return db.collection(`artifacts/${appId}/public/data/${collectionName}`).onSnapshot(
                        (snap) => setter(snap.docs.map(doc => ({ id: doc.id, ...doc.data() }))),
                        (err) => console.error(`Error en ${collectionName}:`, err)
                    );
                };

                const unsubs = [
                    createListener('noticias', setNoticias),
                    createListener('categorias', setCategoriasOposicion),
                    createListener('proximos', setProximosCursos),
                    createListener('usuarios', setListaAlumnos),
                    createListener('documentacion', setDocumentos),
                    createListener('directos', setClasesDirecto)
                ];

                return () => unsubs.forEach(unsub => unsub());
            }, [user]);

            const handleLogin = (e) => {
                e.preventDefault();
                setError('');
                const u = loginForm.username.trim();
                const p = loginForm.password.trim();
                
                if (u.toLowerCase() === 'admin' && p === '22112008') { 
                    setIsAdmin(true); 
                    setLoggedInUser({ nombre: 'Administradora', username: 'admin' }); 
                    setViewMode('private');
                    setShowLogin(false);
                    return; 
                }
                
                const alumno = listaAlumnos.find(a => a.username?.trim().toLowerCase() === u.toLowerCase() && a.password?.trim() === p);
                if (alumno) { 
                    setIsAdmin(false); 
                    setLoggedInUser(alumno); 
                    setViewMode('private'); 
                    setShowLogin(false);
                } else { 
                    setError('Usuario o PIN incorrectos'); 
                }
            };

            const handleLogout = () => {
                setLoggedInUser(null); 
                setIsAdmin(false); 
                setViewMode('public'); 
                setActiveTab('noticias'); 
                setSelectedOpo(null);
            };

            const handleDelete = async (col, docId) => { 
                if (isAdmin && window.confirm('¿Eliminar este registro definitivamente?')) {
                    try {
                        await db.collection(`artifacts/${appId}/public/data/${col}`).doc(docId).delete();
                    } catch (e) {
                        console.error("Error al borrar:", e);
                    }
                }
            };

            const resetFormData = () => {
                setFormData({ 
                    titulo: '', contenido: '', url: '', nombre: '', descripcion: '', 
                    tipo: 'TEMA', username: '', password: '', oposicion: '', fecha: '', 
                    lanzamiento: '', hora: '', plataforma: '' 
                });
                setEditingId(null);
            };

            const openEditCurso = (curso) => {
                setFormData({ ...formData, nombre: curso.nombre, lanzamiento: curso.lanzamiento || '' });
                setEditingId(curso.id);
                setShowModal('curso');
            };

            const openEditAlumno = (alumno) => {
                setFormData({ ...formData, nombre: alumno.nombre, username: alumno.username, password: alumno.password, oposicion: alumno.oposicion });
                setEditingId(alumno.id);
                setShowModal('alumno');
            };

            const openEditNoticia = (n) => {
                setFormData({ ...formData, titulo: n.titulo, contenido: n.contenido, url: n.url || '' });
                setEditingId(n.id);
                setShowModal('noticia');
            };

            const openEditDirecto = (d) => {
                setFormData({ ...formData, titulo: d.titulo, oposicion: d.oposicion, fecha: d.fecha, hora: d.hora, url: d.url });
                setEditingId(d.id);
                setShowModal('directo');
            };

            const openEditProximo = (p) => {
                setFormData({ ...formData, nombre: p.nombre, fecha: p.fecha });
                setEditingId(p.id);
                setShowModal('proximo');
            };

            if (loading) return (
                <div className="h-screen flex items-center justify-center bg-white flex-col gap-4">
                    <div className="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
                    <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">Iniciando Plataforma...</p>
                </div>
            );

            const isShowingPublic = !loggedInUser || viewMode === 'public';

            const formattedDate = dateTime.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
            const formattedTime = dateTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

            // Clase CSS unificada para botones administrativos
            const adminBtnClass = "bg-orange-500 text-white px-6 py-3 rounded-2xl font-black text-xs uppercase shadow-lg hover:bg-orange-600 btn-primary";

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900">
                    <header className="bg-white/95 backdrop-blur-md border-b border-slate-200 px-6 py-6 flex items-center justify-between sticky top-0 z-[60] shadow-sm">
                        <div className="flex items-center gap-8">
                            <img src={LOGO_URL} alt="Logo" className="h-32 md:h-40 w-auto cursor-pointer object-contain transition-all hover:scale-105" onClick={() => { setViewMode('public'); setShowLogin(false); }} />
                            <div className="hidden sm:flex border-l border-slate-200 pl-8 flex-col gap-2">
                                <h1 className="uppercase leading-none tracking-tight flex flex-col">
                                    <span className="text-slate-900 font-black text-xl">PLATAFORMA DE</span>
                                    <span className="text-orange-500 font-extrabold text-xl">FORMACIÓN ONLINE</span>
                                </h1>
                                <div className="flex flex-col text-[10px] font-bold uppercase tracking-widest text-slate-500">
                                    <div className="flex items-center gap-2">
                                        <Icon name="calendar" className="w-3 h-3 text-orange-400" />
                                        <span>{formattedDate}</span>
                                    </div>
                                    <div className="flex items-center gap-2 mt-0.5">
                                        <Icon name="clock" className="w-3 h-3 text-orange-400" />
                                        <span className="text-slate-900">{formattedTime}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            {loggedInUser && (
                                <button 
                                    onClick={() => { setViewMode(viewMode === 'public' ? 'private' : 'public'); setShowLogin(false); }} 
                                    className="px-6 py-3 rounded-xl font-bold text-[11px] uppercase tracking-widest transition-all flex items-center gap-2 border bg-orange-500 text-white border-orange-500 shadow-lg shadow-orange-500/20"
                                >
                                    <Icon name={viewMode === 'public' ? "layout-dashboard" : "home"} className="w-4 h-4" />
                                    <span>{viewMode === 'public' ? "Panel Alumno" : "Inicio"}</span>
                                </button>
                            )}
                            {!loggedInUser ? (
                                <button onClick={() => { setShowLogin(!showLogin); setLoginForm({ username: '', password: '' }); setError(''); }} className="px-8 py-3.5 bg-orange-500 text-white rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-orange-500/20 hover:bg-orange-600 btn-primary">Acceso</button>
                            ) : (
                                <button onClick={handleLogout} className="p-3 bg-slate-100 text-slate-500 hover:bg-red-500 hover:text-white rounded-2xl transition-all shadow-sm"><Icon name="log-out" className="w-6 h-6" /></button>
                            )}
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-6 md:p-12">
                        {isShowingPublic ? (
                            showLogin && !loggedInUser ? (
                                <div className="max-w-md mx-auto py-12 fade-in">
                                    <div className="bg-white p-8 md:p-10 rounded-[2.5rem] shadow-2xl border border-slate-100 text-center relative overflow-hidden">
                                        <div className="absolute top-0 left-0 w-full h-1.5 bg-orange-500"></div>
                                        <h2 className="text-2xl font-black uppercase tracking-tight text-slate-900 mb-6">Iniciar Sesión</h2>
                                        <form onSubmit={handleLogin} className="space-y-4 text-left">
                                            <div className="space-y-1.5">
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-2">Usuario / DNI</label>
                                                <input className="w-full p-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 font-bold" value={loginForm.username} onChange={e => setLoginForm({...loginForm, username: e.target.value})} required />
                                            </div>
                                            <div className="space-y-1.5">
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-2">Contraseña / PIN</label>
                                                <input type="password" placeholder="••••••" className="w-full p-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 font-bold" value={loginForm.password} onChange={e => setLoginForm({...loginForm, password: e.target.value})} required />
                                            </div>
                                            {error && <div className="text-red-600 text-[10px] font-bold bg-red-50 p-4 rounded-xl border border-red-100 uppercase">{error}</div>}
                                            <button type="submit" className="w-full py-5 bg-orange-500 text-white rounded-2xl font-black text-sm uppercase shadow-xl shadow-orange-500/20 mt-4 hover:bg-orange-600 btn-primary">Entrar a la Plataforma</button>
                                            <button type="button" onClick={() => setShowLogin(false)} className="w-full text-[10px] font-bold text-slate-400 uppercase text-center mt-4 hover:text-slate-600">Volver al inicio</button>
                                        </form>
                                    </div>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 lg:grid-cols-12 gap-10">
                                    <div className="lg:col-span-12 xl:col-span-7">
                                        <div className="flex items-center justify-between mb-6 border-b border-slate-200 pb-4">
                                            <div className="flex flex-col"><h2 className="text-2xl font-black uppercase tracking-tighter">Últimas Noticias</h2><span className="text-[9px] font-bold text-orange-500 uppercase tracking-[0.2em] mt-0.5">Comunicados Oficiales</span></div>
                                            <Icon name="rss" className="text-slate-300" />
                                        </div>
                                        <div className="bg-slate-100/30 rounded-[2.5rem] p-2 border border-slate-200/50">
                                            <div className="space-y-6 max-h-[700px] overflow-y-auto p-4 custom-scrollbar">
                                                {noticias.length > 0 ? [...noticias].sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).map(n => (
                                                    <article key={n.id} className="card-unified group fade-in">
                                                        <div className="flex justify-between items-start">
                                                            <span className="px-3 py-1 rounded-full bg-orange-50 text-orange-600 text-[10px] font-bold uppercase border border-orange-100 transition-colors group-hover:bg-orange-500 group-hover:text-white w-fit">{n.date}</span>
                                                            <Icon name="bell" className="w-3 h-3 text-slate-200 group-hover:text-orange-300 transition-colors" />
                                                        </div>
                                                        <h3 className="text-xl font-black mt-4 mb-2 leading-tight group-hover:text-orange-600 transition-colors">{n.titulo}</h3>
                                                        <p className="text-slate-500 text-sm leading-relaxed mb-6 whitespace-pre-wrap">{n.contenido}</p>
                                                        {n.url && <a href={n.url} target="_blank" rel="noopener noreferrer" className="text-[11px] font-black uppercase text-orange-500 flex items-center gap-2 hover:translate-x-1 transition-transform w-fit mt-auto border-b-2 border-orange-100 hover:border-orange-500 pb-1">SABER MÁS <Icon name="chevron-right" className="w-4 h-4"/></a>}
                                                    </article>
                                                )) : <p className="p-12 text-center text-slate-300 font-bold uppercase text-sm italic">No hay comunicados actuales</p>}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-12 xl:col-span-5 space-y-10">
                                        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-1 gap-10">
                                            <section className="space-y-6">
                                                <div className="flex items-center justify-between border-b border-slate-200 pb-4"><h2 className="text-xl font-black uppercase tracking-tighter">Próximos Cursos</h2><Icon name="calendar-days" className="text-slate-300" /></div>
                                                <div className="bg-slate-100/30 rounded-[2rem] p-1 border border-slate-200/50"><div className="space-y-4 max-h-[280px] overflow-y-auto p-3 custom-scrollbar">{proximosCursos.length > 0 ? proximosCursos.map(p => (<div key={p.id} className="card-unified group relative overflow-hidden p-6 border-l-4 border-l-orange-500"><span className="px-3 py-1 rounded-full bg-slate-50 text-slate-600 text-[9px] font-bold uppercase border border-slate-100 group-hover:bg-orange-500 group-hover:text-white transition-colors w-fit">{p.fecha}</span><h4 className="font-black text-sm uppercase text-slate-800 mt-4 leading-tight">{p.nombre}</h4></div>)) : <div className="card-unified text-center p-8 bg-slate-50 border-dashed"><p className="text-[9px] text-slate-400 font-bold uppercase italic">No hay fechas publicadas</p></div>}</div></div>
                                            </section>
                                            <section className="space-y-6">
                                                <div className="flex items-center justify-between border-b border-slate-200 pb-4"><h2 className="text-xl font-black uppercase tracking-tighter">Cursos Disponibles</h2><Icon name="layers" className="text-slate-300" /></div>
                                                <div className="bg-slate-100/30 rounded-[2rem] p-1 border border-slate-200/50"><div className="space-y-4 max-h-[280px] overflow-y-auto p-3 custom-scrollbar">{categoriasOposicion.length > 0 ? categoriasOposicion.map(cat => { const isOpen = cat.lanzamiento?.toUpperCase().includes("ABIERTA") || cat.lanzamiento?.toUpperCase().includes("ACTIVO"); return (<div key={cat.id} className="card-unified group p-6"><h4 className="font-black text-sm uppercase text-slate-800 leading-tight">{cat.nombre}</h4><div className="mt-4 flex items-center justify-between"><span className={`px-3 py-1 rounded-lg text-[8px] font-black uppercase border transition-all ${isOpen ? 'bg-green-50 text-green-600 border-green-100' : 'bg-red-50 text-red-600 border-red-100'}`}>{isOpen ? 'Inscripción Abierta' : 'Plazo Cerrado'}</span><div className={`p-1.5 rounded-full ${isOpen ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}><Icon name={isOpen ? "check" : "lock"} className="w-3 h-3" /></div></div><p className="text-[8px] font-bold text-slate-400 uppercase mt-3 tracking-widest border-t border-slate-50 pt-3">{cat.lanzamiento || 'CONSULTAR FECHAS'}</p></div>);}) : <div className="card-unified text-center p-8 bg-slate-50 border-dashed"><p className="text-[9px] text-slate-400 font-bold uppercase italic">No hay especialidades cargadas</p></div>}</div></div>
                                            </section>
                                        </div>
                                        <button onClick={() => setShowModal('contacto')} className="w-full bg-slate-900 text-white p-8 rounded-[2.5rem] font-black uppercase flex flex-col items-center gap-4 hover:bg-orange-600 transition-all btn-primary shadow-xl shadow-slate-900/10 group"><div className="p-4 bg-orange-500 rounded-2xl shadow-lg shadow-orange-500/30 group-hover:bg-white group-hover:text-orange-600 transition-colors"><Icon name="message-circle" className="w-8 h-8" /></div><div className="text-center"><p className="text-xs tracking-widest">Soporte Técnico / Dudas</p><p className="text-[10px] text-slate-400 group-hover:text-orange-100 mt-1">Chat directo por WhatsApp</p></div></button>
                                    </div>
                                </div>
                            )
                        ) : (
                            <div className="flex flex-col lg:flex-row gap-8">
                                <nav className="w-full lg:w-72 flex flex-col gap-2 shrink-0">
                                    <div className="bg-white p-4 rounded-3xl border border-slate-200 shadow-sm mb-4">
                                        <p className="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2 px-2">Usuario Activo</p>
                                        <div className="flex items-center gap-3 px-2"><div className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center font-black text-xs">{loggedInUser.nombre.charAt(0)}</div><span className="font-bold text-sm truncate">{loggedInUser.nombre}</span></div>
                                    </div>
                                    <button onClick={() => {setActiveTab('noticias'); setSelectedOpo(null);}} className={`flex items-center gap-4 p-4 rounded-2xl font-black text-xs uppercase transition-all border border-transparent ${activeTab === 'noticias' && !selectedOpo ? 'btn-active-orange' : 'text-slate-400 hover:bg-white hover:text-slate-600'}`}><Icon name="home" className={activeTab === 'noticias' && !selectedOpo ? "text-white" : ""} /> NOVEDADES</button>
                                    <button onClick={() => {setActiveTab('directos'); setSelectedOpo(null);}} className={`flex items-center gap-4 p-4 rounded-2xl font-black text-xs uppercase transition-all border border-transparent ${activeTab === 'directos' ? 'btn-active-orange' : 'text-slate-400 hover:bg-white hover:text-slate-600'}`}><Icon name="video" className={activeTab === 'directos' ? "text-white" : ""} /> CLASES EN VIVO</button>
                                    {isAdmin && (
                                        <div className="mt-6 space-y-1">
                                            <p className="px-4 text-[10px] font-black text-slate-300 uppercase tracking-widest mb-2">Administración</p>
                                            <button onClick={() => {setActiveTab('cursos'); setSelectedOpo(null);}} className={`w-full text-left p-4 rounded-2xl font-black text-xs uppercase transition-all border border-transparent ${activeTab === 'cursos' ? 'btn-active-orange' : 'text-slate-400 hover:bg-white hover:text-slate-600'}`}>Gestión Cursos</button>
                                            <button onClick={() => {setActiveTab('alumnos'); setSelectedOpo(null);}} className={`w-full text-left p-4 rounded-2xl font-black text-xs uppercase transition-all border border-transparent ${activeTab === 'alumnos' ? 'btn-active-orange' : 'text-slate-400 hover:bg-white hover:text-slate-600'}`}>Matrículas</button>
                                        </div>
                                    )}
                                    <p className="mt-6 px-4 text-[10px] font-black text-slate-300 uppercase tracking-widest mb-2">Mis Recursos</p>
                                    <div className="space-y-1">{categoriasOposicion.filter(c => isAdmin || (loggedInUser && (loggedInUser.oposicion === c.nombre || loggedInUser.oposicion === 'Todas'))).map(c => (<button key={c.id} onClick={() => {setActiveTab('oposicion'); setSelectedOpo(c.nombre);}} className={`w-full text-left p-4 rounded-xl font-bold text-[11px] uppercase border transition-all ${selectedOpo === c.nombre ? 'btn-active-orange' : 'text-slate-400 border-transparent hover:bg-white hover:text-slate-600'}`}>{c.nombre}</button>))}</div>
                                </nav>

                                <div className="flex-1 space-y-8 min-w-0">
                                    {activeTab === 'noticias' && !selectedOpo && (
                                        <div className="bg-white p-8 md:p-12 rounded-[2.5rem] border border-slate-200 shadow-sm fade-in">
                                            <div className="flex justify-between items-center mb-10 flex-wrap gap-4">
                                                <div><h2 className="text-2xl font-black uppercase text-slate-800">Panel de Novedades</h2><p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Comunicados internos</p></div>
                                                {isAdmin && <button onClick={() => {resetFormData(); setShowModal('noticia');}} className={adminBtnClass}>Nuevo Comunicado</button>}
                                            </div>
                                            <div className="space-y-6">
                                                {[...noticias].sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).map(n => (
                                                    <div key={n.id} className="p-8 bg-slate-50 rounded-[2rem] relative group hover:bg-white hover:shadow-xl transition-all border border-transparent hover:border-orange-100">
                                                        <div className="flex justify-between items-start mb-4">
                                                            <span className="px-3 py-1 bg-white text-orange-500 rounded-lg text-[10px] font-black uppercase border border-orange-100">{n.date}</span>
                                                            {isAdmin && (
                                                                <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                    <button onClick={() => openEditNoticia(n)} className="p-2 text-slate-400 hover:text-blue-500"><Icon name="edit-3" className="w-4 h-4" /></button>
                                                                    <button onClick={() => handleDelete('noticias', n.id)} className="text-slate-300 hover:text-red-500 p-2"><Icon name="trash-2" className="w-4 h-4" /></button>
                                                                </div>
                                                            )}
                                                        </div>
                                                        <h4 className="text-xl font-black mb-3 leading-tight">{n.titulo}</h4>
                                                        <p className="text-slate-500 text-sm whitespace-pre-wrap leading-relaxed">{n.contenido}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'cursos' && isAdmin && (
                                        <div className="space-y-12 fade-in">
                                            <section className="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm">
                                                <div className="flex justify-between items-center mb-8">
                                                    <h3 className="text-xl font-black uppercase tracking-tight text-slate-800">Especialidades Disponibles</h3>
                                                    <button onClick={() => {resetFormData(); setShowModal('curso');}} className={adminBtnClass}>Añadir Especialidad</button>
                                                </div>
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                    {categoriasOposicion.map(cat => (
                                                        <div key={cat.id} className="p-5 bg-slate-50 rounded-2xl flex items-center justify-between border border-transparent hover:border-orange-200 transition-all group">
                                                            <div>
                                                                <h4 className="font-bold text-sm uppercase">{cat.nombre}</h4>
                                                                <p className="text-[9px] text-orange-500 font-black uppercase mt-1">{cat.lanzamiento || 'ACTIVO'}</p>
                                                            </div>
                                                            <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                <button onClick={() => openEditCurso(cat)} className="p-2 text-slate-400 hover:text-blue-500"><Icon name="edit-3" className="w-4 h-4"/></button>
                                                                <button onClick={() => handleDelete('categorias', cat.id)} className="p-2 text-slate-400 hover:text-red-500 transition-colors"><Icon name="trash-2" className="w-4 h-4"/></button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </section>

                                            <section className="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm">
                                                <div className="flex justify-between items-center mb-8">
                                                    <h3 className="text-xl font-black uppercase tracking-tight text-slate-800">Agenda: Próximas Fechas</h3>
                                                    <button onClick={() => {resetFormData(); setShowModal('proximo');}} className={adminBtnClass}>Añadir Fecha Curso</button>
                                                </div>
                                                <div className="space-y-3">
                                                    {proximosCursos.map(p => (
                                                        <div key={p.id} className="p-5 bg-slate-50 rounded-2xl flex items-center justify-between border border-transparent hover:border-orange-200 group transition-all">
                                                            <div className="flex items-center gap-4">
                                                                <span className="px-3 py-1 bg-white text-orange-500 rounded-lg text-[9px] font-black uppercase border border-orange-100">{p.fecha}</span>
                                                                <h4 className="font-bold text-sm uppercase text-slate-700">{p.nombre}</h4>
                                                            </div>
                                                            <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                <button onClick={() => openEditProximo(p)} className="p-2 text-slate-400 hover:text-blue-500"><Icon name="edit-3" className="w-4 h-4"/></button>
                                                                <button onClick={() => handleDelete('proximos', p.id)} className="p-2 text-slate-400 hover:text-red-500 transition-colors"><Icon name="trash-2" className="w-4 h-4"/></button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </section>
                                        </div>
                                    )}

                                    {activeTab === 'alumnos' && isAdmin && (
                                        <div className="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm fade-in">
                                            <div className="flex justify-between items-center mb-8">
                                                <h3 className="text-xl font-black uppercase text-slate-800">Gestión de Alumnos</h3>
                                                <button onClick={() => {resetFormData(); setShowModal('alumno');}} className={adminBtnClass}>Nueva Matrícula</button>
                                            </div>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-left">
                                                    <thead className="bg-slate-50 text-[10px] font-black uppercase text-slate-400 border-b border-slate-100">
                                                        <tr>
                                                            <th className="px-4 py-4">Nombre Alumno</th>
                                                            <th className="px-4 py-4">ID / PIN</th>
                                                            <th className="px-4 py-4">Especialidad</th>
                                                            <th className="px-4 py-4 text-right">Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-slate-50">
                                                        {listaAlumnos.filter(a => a.username !== 'admin').map(a => (
                                                            <tr key={a.id} className="hover:bg-slate-50/50 transition-colors group">
                                                                <td className="px-4 py-4 font-bold text-sm">{a.nombre}</td>
                                                                <td className="px-4 py-4 font-mono text-[10px]">
                                                                    <span className="bg-white px-2 py-1 rounded border border-slate-200 mr-2">{a.username}</span>
                                                                    <span className="bg-orange-50 text-orange-600 px-2 py-1 rounded border border-orange-100">{a.password}</span>
                                                                </td>
                                                                <td className="px-4 py-4">
                                                                    <span className="px-3 py-1 bg-slate-100 text-slate-600 rounded-lg font-black text-[9px] uppercase">{a.oposicion}</span>
                                                                </td>
                                                                <td className="px-4 py-4 text-right">
                                                                    <div className="flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                        <button onClick={() => openEditAlumno(a)} className="p-2 text-slate-400 hover:text-blue-500"><Icon name="edit-3" className="w-4 h-4"/></button>
                                                                        <button onClick={() => handleDelete('usuarios', a.id)} className="p-2 text-slate-300 hover:text-red-500 transition-colors"><Icon name="trash-2" className="w-4 h-4"/></button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'directos' && (
                                        <div className="bg-white p-8 md:p-12 rounded-[2.5rem] border border-slate-200 shadow-sm fade-in">
                                            <div className="flex justify-between items-center mb-10 flex-wrap gap-4">
                                                <div><h2 className="text-2xl font-black uppercase text-slate-800">Directos</h2><p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Acceso a clases virtuales</p></div>
                                                {isAdmin && <button onClick={() => {resetFormData(); setShowModal('directo');}} className={adminBtnClass}>Programar Clase</button>}
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                {clasesDirecto.length > 0 ? clasesDirecto.map(clase => (
                                                    <div key={clase.id} className="bg-slate-50 p-8 rounded-[2rem] border border-transparent hover:border-orange-200 group transition-all relative overflow-hidden hover:bg-white hover:shadow-lg">
                                                        <div className="flex items-center gap-5 mb-6">
                                                            <div className="p-4 bg-orange-100 text-orange-600 rounded-2xl group-hover:bg-orange-500 group-hover:text-white transition-all"><Icon name="video" className="w-8 h-8" /></div>
                                                            <div><h4 className="font-black text-base uppercase leading-tight">{clase.titulo}</h4><p className="text-[10px] font-bold text-slate-400 mt-1 uppercase">{clase.oposicion}</p></div>
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-4 mb-8">
                                                            <div className="p-3 bg-white rounded-xl flex items-center gap-2 border border-slate-100"><Icon name="calendar" className="text-orange-500 w-4 h-4"/><span className="text-[10px] font-bold uppercase">{clase.fecha}</span></div>
                                                            <div className="p-3 bg-white rounded-xl flex items-center gap-2 border border-slate-100"><Icon name="clock" className="text-orange-500 w-4 h-4"/><span className="text-[10px] font-bold uppercase">{clase.hora}h</span></div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <a href={clase.url} target="_blank" rel="noopener noreferrer" className="flex-1 py-4 bg-slate-900 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest flex justify-center gap-3 hover:bg-orange-600 transition-all btn-primary">Entrar al Aula</a>
                                                            {isAdmin && (
                                                                <div className="flex flex-col gap-2">
                                                                    <button onClick={() => openEditDirecto(clase)} className="p-3 bg-blue-50 text-blue-500 rounded-xl hover:bg-blue-500 hover:text-white transition-all"><Icon name="edit-3" className="w-4 h-4" /></button>
                                                                    <button onClick={() => handleDelete('directos', clase.id)} className="p-3 bg-red-50 text-red-500 rounded-xl hover:bg-red-500 hover:text-white transition-all"><Icon name="trash-2" className="w-4 h-4" /></button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )) : <p className="col-span-full text-center py-20 text-[11px] font-bold text-slate-300 uppercase italic">No hay clases en directo actualmente</p>}
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'oposicion' && selectedOpo && (
                                        <div className="bg-white p-8 md:p-12 rounded-[2.5rem] border border-slate-200 shadow-sm fade-in">
                                            <div className="flex justify-between items-center mb-10 flex-wrap gap-4">
                                                <div><h2 className="text-2xl md:text-3xl font-black uppercase text-slate-800 leading-tight">{selectedOpo}</h2><p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Biblioteca de recursos</p></div>
                                                {isAdmin && <button onClick={() => {resetFormData(); setShowModal('documento');}} className={adminBtnClass}>Añadir Archivos</button>}
                                            </div>
                                            <div className="space-y-12">
                                                {Object.entries(TIPO_MATERIAL).map(([key, config]) => {
                                                    const docs = documentos.filter(d => d.oposicion === selectedOpo && d.tipo === key);
                                                    if (docs.length === 0 && !isAdmin) return null;
                                                    return (
                                                        <div key={key}>
                                                            <div className="flex items-center gap-4 mb-6"><div className={`p-3 rounded-xl ${config.color}`}><Icon name={config.icon} className="w-5 h-5" /></div><h3 className="font-black text-xs uppercase text-slate-700">{config.label}</h3><div className="flex-1 h-px bg-slate-100"></div></div>
                                                            <div className="grid grid-cols-1 gap-3">{docs.map(docItem => (<div key={docItem.id} className="flex flex-col md:flex-row items-center justify-between p-6 bg-slate-50 rounded-2xl border border-transparent hover:border-orange-100 hover:bg-white transition-all group"><div className="flex items-center gap-5 w-full md:w-auto mb-4 md:mb-0"><Icon name="file-text" className="text-slate-300" /><div><span className="font-bold text-sm uppercase text-slate-900 leading-tight block">{docItem.titulo}</span><span className="text-[9px] font-black text-slate-400 uppercase tracking-tighter">Material Oficial</span></div></div><div className="flex items-center gap-3 w-full md:w-auto justify-end"><a href={docItem.url} target="_blank" rel="noopener noreferrer" className={`px-6 py-3 rounded-xl font-black text-[10px] uppercase shadow-md transition-all btn-primary ${key === 'TEST' ? 'bg-amber-500 text-white' : 'bg-slate-900 text-white hover:bg-orange-600'}`}>{key === 'TEST' ? 'Hacer Test' : 'Ver / Descargar'}</a>{isAdmin && <button onClick={() => handleDelete('documentacion', docItem.id)} className="p-2 text-slate-300 hover:text-red-500"><Icon name="trash-2" className="w-4 h-4"/></button>}</div></div>))}</div>
                                                        </div>
                                                    )
                                                })}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* MODALES */}
                    {showModal === 'curso' && isAdmin && (
                        <Modal title={editingId ? "Editar Especialidad" : "Añadir Especialidad"} onClose={() => {setShowModal(null); resetFormData();}}>
                            <form onSubmit={async (e) => {
                                e.preventDefault();
                                const data = { nombre: formData.nombre.trim(), lanzamiento: formData.lanzamiento.trim(), timestamp: Date.now() };
                                if (editingId) { await db.collection(`artifacts/${appId}/public/data/categorias`).doc(editingId).update(data); }
                                else { await db.collection(`artifacts/${appId}/public/data/categorias`).add(data); }
                                setShowModal(null); resetFormData();
                            }} className="space-y-4">
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-bold uppercase text-xs border border-slate-200" value={formData.nombre} placeholder="Nombre de la Oposición" onChange={e => setFormData({...formData, nombre: e.target.value})} required />
                                <input className="w-full p-4 bg-slate-50 rounded-2xl text-xs font-bold text-orange-600 uppercase border border-slate-200" value={formData.lanzamiento} placeholder="Estado (Ej: MATRÍCULA ABIERTA)" onChange={e => setFormData({...formData, lanzamiento: e.target.value})} required />
                                <button type="submit" className="w-full py-5 bg-orange-500 text-white rounded-2xl font-black uppercase shadow-lg text-sm btn-primary">{editingId ? "Guardar Cambios" : "Guardar Especialidad"}</button>
                            </form>
                        </Modal>
                    )}

                    {showModal === 'proximo' && isAdmin && (
                        <Modal title={editingId ? "Editar Fecha de Curso" : "Programar Próximo Curso"} onClose={() => {setShowModal(null); resetFormData();}}>
                            <form onSubmit={async (e) => {
                                e.preventDefault();
                                const data = { nombre: formData.nombre.trim(), fecha: formData.fecha.trim(), timestamp: Date.now() };
                                if (editingId) { await db.collection(`artifacts/${appId}/public/data/proximos`).doc(editingId).update(data); }
                                else { await db.collection(`artifacts/${appId}/public/data/proximos`).add(data); }
                                setShowModal(null); resetFormData();
                            }} className="space-y-4">
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-bold uppercase text-xs border border-slate-200" value={formData.nombre} placeholder="Nombre del Curso (Ej: ADMINISTRATIVO)" onChange={e => setFormData({...formData, nombre: e.target.value})} required />
                                <input className="w-full p-4 bg-slate-50 rounded-2xl text-xs font-bold text-orange-600 uppercase border border-slate-200" value={formData.fecha} placeholder="Fecha de Inicio (Ej: 15 DE MARZO)" onChange={e => setFormData({...formData, fecha: e.target.value})} required />
                                <button type="submit" className="w-full py-5 bg-orange-500 text-white rounded-2xl font-black uppercase shadow-lg text-sm btn-primary">{editingId ? "Actualizar Fecha" : "Programar Curso"}</button>
                            </form>
                        </Modal>
                    )}

                    {showModal === 'alumno' && isAdmin && (
                        <Modal title={editingId ? "Editar Matrícula" : "Matricular Nuevo Alumno"} onClose={() => {setShowModal(null); resetFormData();}}>
                            <form onSubmit={async (e) => {
                                e.preventDefault();
                                const data = { nombre: formData.nombre.trim(), username: formData.username.trim(), password: formData.password.trim(), oposicion: formData.oposicion };
                                if (editingId) { await db.collection(`artifacts/${appId}/public/data/usuarios`).doc(editingId).update(data); }
                                else { await db.collection(`artifacts/${appId}/public/data/usuarios`).add(data); }
                                setShowModal(null); resetFormData();
                            }} className="space-y-4">
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-bold border border-slate-200 outline-none" value={formData.nombre} placeholder="Nombre completo del alumno" onChange={e => setFormData({...formData, nombre: e.target.value})} required />
                                <div className="grid grid-cols-2 gap-4">
                                    <input className="w-full p-4 bg-slate-50 rounded-2xl font-mono text-sm border border-slate-200 outline-none" value={formData.username} placeholder="ID / Usuario" onChange={e => setFormData({...formData, username: e.target.value})} required />
                                    <input className="w-full p-4 bg-slate-50 rounded-2xl font-mono text-sm border border-slate-200 outline-none" value={formData.password} placeholder="PIN / Clave" onChange={e => setFormData({...formData, password: e.target.value})} required />
                                </div>
                                <select className="w-full p-4 bg-slate-50 rounded-2xl font-black text-[10px] uppercase border border-slate-200 outline-none" value={formData.oposicion} onChange={e => setFormData({...formData, oposicion: e.target.value})} required>
                                    <option value="">-- Asignar a Oposición --</option>
                                    <option value="Todas">Acceso Total</option>
                                    {categoriasOposicion.map(c => <option key={c.id} value={c.nombre}>{c.nombre}</option>)}
                                </select>
                                <button type="submit" className="w-full py-5 bg-orange-500 text-white rounded-2xl font-black uppercase shadow-lg text-sm btn-primary">{editingId ? "Actualizar Alumno" : "Confirmar Alta"}</button>
                            </form>
                        </Modal>
                    )}

                    {showModal === 'noticia' && isAdmin && (
                        <Modal title={editingId ? "Editar Comunicado" : "Redactar Comunicado"} onClose={() => {setShowModal(null); resetFormData();}}>
                            <form onSubmit={async (e) => {
                                e.preventDefault();
                                const data = { titulo: formData.titulo, contenido: formData.contenido, url: formData.url, timestamp: Date.now() };
                                if (editingId) { await db.collection(`artifacts/${appId}/public/data/noticias`).doc(editingId).update(data); }
                                else { await db.collection(`artifacts/${appId}/public/data/noticias`).add({ ...data, date: new Date().toLocaleDateString() }); }
                                setShowModal(null); resetFormData();
                            }} className="space-y-4">
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-bold uppercase text-xs border border-slate-200" value={formData.titulo} placeholder="Título de la noticia" onChange={e => setFormData({...formData, titulo: e.target.value})} required />
                                <textarea className="w-full p-4 bg-slate-50 rounded-2xl text-sm resize-none border border-slate-200" rows="5" value={formData.contenido} placeholder="Contenido del mensaje..." onChange={e => setFormData({...formData, contenido: e.target.value})} required />
                                <input className="w-full p-4 bg-slate-50 rounded-2xl text-[10px] font-mono border border-slate-200" value={formData.url} placeholder="Enlace externo (opcional)" onChange={e => setFormData({...formData, url: e.target.value})} />
                                <button type="submit" className="w-full py-5 bg-orange-500 text-white rounded-2xl font-black uppercase shadow-lg text-sm btn-primary">{editingId ? "Actualizar Noticia" : "Publicar Ahora"}</button>
                            </form>
                        </Modal>
                    )}

                    {showModal === 'directo' && isAdmin && (
                        <Modal title={editingId ? "Editar Aula Virtual" : "Programar Aula Virtual"} onClose={() => {setShowModal(null); resetFormData();}}>
                            <form onSubmit={async (e) => {
                                e.preventDefault();
                                const data = { titulo: formData.titulo, oposicion: formData.oposicion, fecha: formData.fecha, hora: formData.hora, url: formData.url, timestamp: Date.now() };
                                if (editingId) { await db.collection(`artifacts/${appId}/public/data/directos`).doc(editingId).update(data); }
                                else { await db.collection(`artifacts/${appId}/public/data/directos`).add(data); }
                                setShowModal(null); resetFormData();
                            }} className="space-y-4">
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-bold uppercase text-xs border border-slate-200" value={formData.titulo} placeholder="Título de la clase" onChange={e => setFormData({...formData, titulo: e.target.value})} required />
                                <select className="w-full p-4 bg-slate-50 rounded-2xl font-black text-[10px] uppercase border border-slate-200" value={formData.oposicion} onChange={e => setFormData({...formData, oposicion: e.target.value})} required>
                                    <option value="">-- Especialidad --</option><option value="Todas">Todas</option>
                                    {categoriasOposicion.map(c => <option key={c.id} value={c.nombre}>{c.nombre}</option>)}
                                </select>
                                <div className="grid grid-cols-2 gap-4">
                                    <input type="date" className="w-full p-4 bg-slate-50 rounded-2xl text-xs border border-slate-200" value={formData.fecha} onChange={e => setFormData({...formData, fecha: e.target.value})} required />
                                    <input type="time" className="w-full p-4 bg-slate-50 rounded-2xl text-xs border border-slate-200" value={formData.hora} onChange={e => setFormData({...formData, hora: e.target.value})} required />
                                </div>
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-mono text-[11px] border border-slate-200" value={formData.url} placeholder="URL del Aula (Zoom / Teams / Meet)" onChange={e => setFormData({...formData, url: e.target.value})} required />
                                <button type="submit" className="w-full py-5 bg-orange-500 text-white rounded-2xl font-black uppercase shadow-lg text-sm btn-primary">{editingId ? "Actualizar Clase" : "Programar Ahora"}</button>
                            </form>
                        </Modal>
                    )}

                    {showModal === 'documento' && isAdmin && (
                        <Modal title={`Material: ${selectedOpo}`} onClose={() => {setShowModal(null); resetFormData();}}>
                            <form onSubmit={async (e) => {
                                e.preventDefault();
                                await db.collection(`artifacts/${appId}/public/data/documentacion`).add({ titulo: formData.titulo, url: formData.url, tipo: formData.tipo, oposicion: selectedOpo, timestamp: Date.now() });
                                setShowModal(null); resetFormData();
                            }} className="space-y-5">
                                <div className="grid grid-cols-3 gap-2">{Object.entries(TIPO_MATERIAL).map(([key, cfg]) => (<button key={key} type="button" onClick={() => setFormData({...formData, tipo: key})} className={`p-3 rounded-xl border-2 text-[8px] font-black uppercase flex flex-col items-center gap-2 transition-all ${formData.tipo === key ? 'border-orange-500 bg-orange-50 text-orange-600' : 'border-slate-50 text-slate-400 bg-slate-50 hover:bg-white'}`}><Icon name={cfg.icon} className="w-4 h-4" /> {cfg.label.split(' ')[0]}</button>))}</div>
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-bold uppercase text-xs border border-slate-200" placeholder="Nombre del recurso (Ej: Tema 1)" onChange={e => setFormData({...formData, titulo: e.target.value})} required />
                                <input className="w-full p-4 bg-slate-50 rounded-2xl font-mono text-[11px] border border-slate-200" placeholder="URL del archivo (Google Drive, etc)" onChange={e => setFormData({...formData, url: e.target.value})} required />
                                <button type="submit" className="w-full py-5 bg-slate-900 text-white rounded-2xl font-black uppercase shadow-lg hover:bg-orange-600 transition-all text-sm btn-primary">Subir Material</button>
                            </form>
                        </Modal>
                    )}

                    {showModal === 'contacto' && (
                        <Modal title="Atención al Alumno" onClose={() => setShowModal(null)}>
                            <div className="space-y-4">
                                <a href={`https://wa.me/${CONTACTO.telefono.replace(/\s/g, '')}`} target="_blank" rel="noopener noreferrer" className="flex items-center gap-6 p-8 bg-green-50 rounded-[2rem] border border-transparent hover:border-green-200 group transition-all"><Icon name="phone" className="w-10 h-10 text-green-500" /><div><p className="font-black text-lg text-slate-900 leading-tight">{CONTACTO.telefono}</p><p className="text-[10px] uppercase text-green-600 font-bold mt-1">Soporte Directo WhatsApp</p></div></a>
                                <div className="flex items-center gap-6 p-8 bg-slate-50 rounded-[2rem] border border-slate-100"><Icon name="mail" className="w-10 h-10 text-slate-400" /><div><p className="font-black text-sm text-slate-900 break-all leading-tight">{CONTACTO.email}</p><p className="text-[10px] uppercase text-slate-400 font-bold mt-1">Correo Electrónico</p></div></div>
                            </div>
                        </Modal>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>